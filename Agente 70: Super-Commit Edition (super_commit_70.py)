import os
import shutil
import subprocess
import json

class Agent70SuperCommit:
    def __init__(self):
        self.project_id = "Divineo_Pilot_2026"
        self.db_name = "Divineo_Leads_DB"  # [cite: 2026-02-24]
        # Mapeo de la narrativa a la arquitectura de archivos
        self.deployment_map = {
            "public/assets/": ["hero_video.mp4"],  # Polvo dorado
            "public/media/": [
                "TRYONYOU_Familia_Pitch.mp4",      # El drama de las tallas
                "TRYONYOU___Le_super-h√©ros_de_la_Fashion_Tech.mp4" # El contraste
            ],
            "public/": ["TRYONYOU_PAU_INTRO.mp4"]  # El Chasquido de Pau
        }

    def burn_files_to_disk(self):
        """Consolida la 'Caja Maestra' moviendo los v√≠deos a sus rutas de producci√≥n"""
        print("--- Agente 70: Consolidando la Caja Maestra a fuego ---")
        for target_path, files in self.deployment_map.items():
            os.makedirs(target_path, exist_ok=True)
            for file_name in files:
                if os.path.exists(file_name):
                    shutil.copy(file_name, os.path.join(target_path, file_name))
                    print(f"‚úÖ {file_name} -> {target_path}")
                else:
                    print(f"‚ö†Ô∏è Alerta: {file_name} no detectado. Verificando integridad del sistema.")

    def orchestrate_apis(self):
        """Conecta a Jules V7 con Google Sheets y la automatizaci√≥n de Gmail [cite: 2026-02-24]"""
        print(f"--- Agente 70: Sincronizando Jules V7 con {self.db_name} ---")
        jules_config = {
            "agent": "Jules V7",
            "database": self.db_name,
            "logic_file": "api/index.py", # [cite: 2026-02-24]
            "functions": ["scan_body", "match_clothes", "register_lead"],
            "ui_buttons": [ # Los 5 botones del piloto [cite: 2026-01-29]
                "Mi Selecci√≥n Perfecta", 
                "Reservar en Probador", 
                "Ver Combinaciones", 
                "Guardar mi Silueta", 
                "Compartir Look"
            ]
        }
        with open("api/jules_config.json", "w") as f:
            json.dump(jules_config, f, indent=4)
        print("‚úÖ APIs conectadas al camino de ejecuci√≥n.")

    def execute_deployment(self):
        """Publica el piloto y activa el monitoreo de logs en tiempo real [cite: 2026-02-24]"""
        print("--- Agente 70: Lanzando Super-Commit a Vercel ---")
        try:
            # Despliegue forzado a producci√≥n
            subprocess.run(["vercel", "--prod", "--confirm"], check=True)
            print("\nüöÄ PILOTO EN VIVO: https://tryonyou.app")
            print("üí° Tip: Usa 'vercel logs --follow' para ver a Jules procesar las siluetas.")
        except Exception as e:
            print(f"‚ùå Error cr√≠tico en el despliegue: {e}")

if __name__ == "__main__":
    master_robot = Agent70SuperCommit()
    master_robot.burn_files_to_disk()
    master_robot.orchestrate_apis()
    master_robot.execute_deployment()
