# Makefile for TRYONME-TRYONYOU-ABVETOS--INTELLIGENCE--SYSTEM
# Comprehensive build system that integrates npm scripts and custom bash scripts

.PHONY: all build clean install test dev preview lint validate docs orchestrate push help
.DEFAULT_GOAL := help

# Colors for output
BLUE := \033[34m
GREEN := \033[32m
YELLOW := \033[33m
RED := \033[31m
RESET := \033[0m

##@ Main targets

all: install clean build test lint validate ## üöÄ Build everything (install, clean, build, test, lint, validate)
	@echo "$(GREEN)‚úÖ Make all completed successfully!$(RESET)"

##@ Development

install: ## üì¶ Install all dependencies
	@echo "$(BLUE)üì¶ Installing dependencies...$(RESET)"
	npm install

build: ## üèóÔ∏è  Build the project for production
	@echo "$(BLUE)üèóÔ∏è  Building project...$(RESET)"
	npm run build

dev: ## üöÄ Start development server
	@echo "$(BLUE)üöÄ Starting development server...$(RESET)"
	npm run dev

preview: ## üëÄ Preview the built project
	@echo "$(BLUE)üëÄ Starting preview server...$(RESET)"
	npm run preview

##@ Quality & Testing

test: ## üß™ Run tests and health checks
	@echo "$(BLUE)üß™ Running tests...$(RESET)"
	@if [ -x "./scripts/agent_test.sh" ]; then \
		./scripts/agent_test.sh || echo "$(YELLOW)‚ö†Ô∏è  Some tests failed but continuing...$(RESET)"; \
	else \
		echo "$(YELLOW)‚ö†Ô∏è  Test script not found or not executable$(RESET)"; \
	fi

lint: ## üîç Lint commit messages
	@echo "$(BLUE)üîç Linting commits...$(RESET)"
	@if git rev-parse --git-dir > /dev/null 2>&1; then \
		npm run lint:commits || echo "$(YELLOW)‚ö†Ô∏è  Commit linting failed or not configured$(RESET)"; \
	else \
		echo "$(YELLOW)‚ö†Ô∏è  Not in a git repository, skipping commit lint$(RESET)"; \
	fi

validate: ## ‚úÖ Validate templates and documentation
	@echo "$(BLUE)‚úÖ Validating templates...$(RESET)"
	@if [ -x "./scripts/validate-templates.sh" ]; then \
		npm run validate:templates; \
	else \
		echo "$(YELLOW)‚ö†Ô∏è  Template validation script not found$(RESET)"; \
	fi
	@if [ -x "./scripts/validate-docs.sh" ]; then \
		./scripts/validate-docs.sh; \
	else \
		echo "$(YELLOW)‚ö†Ô∏è  Documentation validation script not found$(RESET)"; \
	fi

##@ Maintenance & Deployment

clean: ## üßπ Clean up temporary files and organize project
	@echo "$(BLUE)üßπ Cleaning up project...$(RESET)"
	@if [ -x "./scripts/agent_clean.sh" ]; then \
		./scripts/agent_clean.sh; \
	else \
		echo "$(YELLOW)‚ö†Ô∏è  Clean script not found, performing basic cleanup$(RESET)"; \
		rm -rf dist/ node_modules/.cache/ .cache/ || true; \
	fi

docs: ## üìë Organize documentation
	@echo "$(BLUE)üìë Organizing documentation...$(RESET)"
	@if [ -x "./scripts/agent_docs.sh" ]; then \
		./scripts/agent_docs.sh; \
	else \
		echo "$(YELLOW)‚ö†Ô∏è  Documentation script not found$(RESET)"; \
	fi

orchestrate: ## üéº Run full ABVET orchestration pipeline
	@echo "$(BLUE)üéº Running ABVET orchestration...$(RESET)"
	@if [ -x "./scripts/abvet_orchestrator.sh" ]; then \
		./scripts/abvet_orchestrator.sh; \
	else \
		echo "$(RED)‚ùå ABVET orchestrator script not found$(RESET)"; \
		exit 1; \
	fi

push: ## ‚¨ÜÔ∏è  Push changes to repository
	@echo "$(BLUE)‚¨ÜÔ∏è  Pushing changes...$(RESET)"
	@if [ -x "./scripts/agent_push.sh" ]; then \
		./scripts/agent_push.sh; \
	else \
		echo "$(YELLOW)‚ö†Ô∏è  Push script not found, manual git push required$(RESET)"; \
	fi

##@ Setup & Configuration

setup: ## ‚öôÔ∏è  Initial project setup
	@echo "$(BLUE)‚öôÔ∏è  Running project setup...$(RESET)"
	@if [ -x "./SETUP.SH" ]; then \
		./SETUP.SH; \
	else \
		echo "$(RED)‚ùå SETUP.SH not found$(RESET)"; \
		exit 1; \
	fi

deploy: ## üöÄ Deploy to production
	@echo "$(BLUE)üöÄ Deploying to production...$(RESET)"
	@if [ -x "./deploy.sh" ]; then \
		./deploy.sh; \
	else \
		echo "$(YELLOW)‚ö†Ô∏è  Deploy script not found, check DEPLOY.md for manual instructions$(RESET)"; \
	fi

##@ Information

status: ## üìä Show project status
	@echo "$(BLUE)üìä Project Status:$(RESET)"
	@echo "Node.js version: $$(node --version 2>/dev/null || echo 'Not installed')"
	@echo "npm version: $$(npm --version 2>/dev/null || echo 'Not installed')"
	@echo "Git status:"
	@git status --porcelain 2>/dev/null || echo "Not in a git repository"
	@echo "Dependencies status:"
	@if [ -f "package.json" ] && [ -d "node_modules" ]; then \
		echo "$(GREEN)‚úÖ Dependencies installed$(RESET)"; \
	else \
		echo "$(RED)‚ùå Dependencies not installed$(RESET)"; \
	fi
	@echo "Build artifacts:"
	@if [ -d "dist" ]; then \
		echo "$(GREEN)‚úÖ Built artifacts found in dist/$(RESET)"; \
		ls -la dist/ | head -5; \
	else \
		echo "$(YELLOW)‚ö†Ô∏è  No build artifacts found$(RESET)"; \
	fi

check-scripts: ## üîß Check if all required scripts are executable
	@echo "$(BLUE)üîß Checking script permissions...$(RESET)"
	@for script in scripts/*.sh SETUP.SH deploy.sh; do \
		if [ -f "$$script" ]; then \
			if [ -x "$$script" ]; then \
				echo "$(GREEN)‚úÖ $$script$(RESET)"; \
			else \
				echo "$(RED)‚ùå $$script (not executable)$(RESET)"; \
			fi; \
		else \
			echo "$(YELLOW)‚ö†Ô∏è  $$script (not found)$(RESET)"; \
		fi; \
	done

##@ Help

help: ## üìñ Show this help message
	@echo "$(BLUE)TRYONME-TRYONYOU-ABVETOS Intelligence System$(RESET)"
	@echo "Available targets:"
	@awk 'BEGIN {FS = ":.*##"; printf "\n"} /^[a-zA-Z_0-9-]+:.*?##/ { printf "  $(GREEN)%-15s$(RESET) %s\n", $$1, $$2 } /^##@/ { printf "\n$(YELLOW)%s$(RESET)\n", substr($$0, 5) } ' $(MAKEFILE_LIST)
	@echo ""
	@echo "$(BLUE)Examples:$(RESET)"
	@echo "  make all          # Build everything from scratch"
	@echo "  make dev          # Start development server"
	@echo "  make build        # Build for production"
	@echo "  make orchestrate  # Run full ABVET pipeline"
	@echo "  make status       # Check project status"