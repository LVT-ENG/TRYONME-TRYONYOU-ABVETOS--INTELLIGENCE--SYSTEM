const n=new class{constructor(){this.config={partnerId:null,apiKey:null,theme:"light",apiEndpoint:"https://api.tryonyou.app",cdnEndpoint:"https://cdn.tryonyou.app",products:[],container:"tryonyou-widget",language:"es",currency:"EUR"},this.isInitialized=!1,this.widgetContainer=null,this.currentUser=null,this.products=[]}init(n={}){if(this.isInitialized)console.warn("TryOnYou is already initialized");else{if(this.config={...this.config,...n},!this.config.partnerId)throw new Error("partnerId is required for TryOnYou initialization");this._loadStyles(),this._createWidget(),this._loadProducts(),this.isInitialized=!0,this._triggerEvent("initialized",{config:this.config}),console.log("TryOnYou SDK initialized for partner:",this.config.partnerId)}}_loadStyles(){if(document.getElementById("tryonyou-styles"))return;const n=document.createElement("link");n.id="tryonyou-styles",n.rel="stylesheet",n.href=`${this.config.cdnEndpoint}/embed.css`,document.head.appendChild(n);const t=document.createElement("style");t.id="tryonyou-critical-styles",t.textContent=this._getCriticalCSS(),document.head.appendChild(t)}_getCriticalCSS(){return"\n      .tryonyou-widget {\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;\n        position: fixed;\n        bottom: 20px;\n        right: 20px;\n        z-index: 10000;\n        border-radius: 12px;\n        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);\n        background: #fff;\n        transition: all 0.3s ease;\n      }\n      \n      .tryonyou-widget.theme-dark {\n        background: #1a1a1a;\n        color: #fff;\n      }\n      \n      .tryonyou-trigger {\n        width: 60px;\n        height: 60px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n        border: none;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        color: white;\n        font-size: 24px;\n        transition: transform 0.2s ease;\n      }\n      \n      .tryonyou-trigger:hover {\n        transform: scale(1.1);\n      }\n      \n      .tryonyou-panel {\n        width: 320px;\n        height: 480px;\n        display: none;\n        flex-direction: column;\n        position: absolute;\n        bottom: 70px;\n        right: 0;\n        background: inherit;\n        border-radius: 12px;\n        overflow: hidden;\n      }\n      \n      .tryonyou-panel.open {\n        display: flex;\n      }\n      \n      .tryonyou-header {\n        padding: 16px;\n        border-bottom: 1px solid #eee;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n      }\n      \n      .theme-dark .tryonyou-header {\n        border-bottom-color: #333;\n      }\n      \n      .tryonyou-content {\n        flex: 1;\n        overflow-y: auto;\n        padding: 16px;\n      }\n      \n      .tryonyou-product {\n        display: flex;\n        align-items: center;\n        padding: 12px;\n        margin-bottom: 8px;\n        border: 1px solid #eee;\n        border-radius: 8px;\n        cursor: pointer;\n        transition: all 0.2s ease;\n      }\n      \n      .tryonyou-product:hover {\n        border-color: #667eea;\n        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);\n      }\n      \n      .theme-dark .tryonyou-product {\n        border-color: #333;\n      }\n      \n      .tryonyou-product-image {\n        width: 48px;\n        height: 48px;\n        border-radius: 6px;\n        object-fit: cover;\n        margin-right: 12px;\n      }\n      \n      .tryonyou-product-info h4 {\n        margin: 0 0 4px 0;\n        font-size: 14px;\n        font-weight: 600;\n      }\n      \n      .tryonyou-product-info p {\n        margin: 0;\n        font-size: 12px;\n        color: #666;\n      }\n      \n      .theme-dark .tryonyou-product-info p {\n        color: #999;\n      }\n      \n      .tryonyou-avatar-button {\n        width: 100%;\n        padding: 12px;\n        margin-top: 16px;\n        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n        color: white;\n        border: none;\n        border-radius: 8px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: opacity 0.2s ease;\n      }\n      \n      .tryonyou-avatar-button:hover {\n        opacity: 0.9;\n      }\n      \n      .tryonyou-loading {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: 40px;\n        color: #666;\n      }\n      \n      .tryonyou-spinner {\n        width: 20px;\n        height: 20px;\n        border: 2px solid #eee;\n        border-top: 2px solid #667eea;\n        border-radius: 50%;\n        animation: tryonyou-spin 1s linear infinite;\n        margin-right: 8px;\n      }\n      \n      @keyframes tryonyou-spin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n      }\n    "}_createWidget(){let n=document.getElementById(this.config.container);n||(n=document.createElement("div"),n.id=this.config.container,document.body.appendChild(n)),this.widgetContainer=n,n.innerHTML=`\n      <div class="tryonyou-widget ${"dark"===this.config.theme?"theme-dark":""}">\n        <button class="tryonyou-trigger" id="tryonyou-trigger">\n          游녱\n        </button>\n        <div class="tryonyou-panel" id="tryonyou-panel">\n          <div class="tryonyou-header">\n            <h3 style="margin: 0; font-size: 16px;">Probador Virtual</h3>\n            <button id="tryonyou-close" style="background: none; border: none; font-size: 18px; cursor: pointer;">칑</button>\n          </div>\n          <div class="tryonyou-content" id="tryonyou-content">\n            <div class="tryonyou-loading">\n              <div class="tryonyou-spinner"></div>\n              Cargando productos...\n            </div>\n          </div>\n        </div>\n      </div>\n    `,this._attachEventListeners()}_attachEventListeners(){const n=document.getElementById("tryonyou-trigger"),t=document.getElementById("tryonyou-close");document.getElementById("tryonyou-panel"),n?.addEventListener("click",()=>this.togglePanel()),t?.addEventListener("click",()=>this.closePanel()),document.addEventListener("click",n=>{this.widgetContainer?.contains(n.target)||this.closePanel()})}async _loadProducts(){try{if(this.config.products&&this.config.products.length>0){const n=await this._fetchProducts(this.config.products);this._renderProducts(n)}else{const n=await this._fetchFeaturedProducts();this._renderProducts(n)}}catch(n){console.error("Error loading products:",n),this._renderError("Error cargando productos")}}async _fetchProducts(n){return[{id:"p1",name:"Chaqueta Premium",price:"89.99",image:"https://via.placeholder.com/200x200/667eea/ffffff?text=Chaqueta",brand:this.config.partnerId,category:"outerwear"},{id:"p2",name:"Jeans Cl치sicos",price:"59.99",image:"https://via.placeholder.com/200x200/764ba2/ffffff?text=Jeans",brand:this.config.partnerId,category:"pants"},{id:"p3",name:"Camiseta B치sica",price:"24.99",image:"https://via.placeholder.com/200x200/48bb78/ffffff?text=Camiseta",brand:this.config.partnerId,category:"tops"}]}async _fetchFeaturedProducts(){return this._fetchProducts(["featured"])}_renderProducts(n){const t=document.getElementById("tryonyou-content");if(!t)return;this.products=n;const e=`\n      ${n.map(n=>`\n        <div class="tryonyou-product" data-product-id="${n.id}">\n          <img src="${n.image}" alt="${n.name}" class="tryonyou-product-image">\n          <div class="tryonyou-product-info">\n            <h4>${n.name}</h4>\n            <p>${this.config.currency} ${n.price}</p>\n          </div>\n        </div>\n      `).join("")}\n      <button class="tryonyou-avatar-button" id="tryonyou-create-avatar">\n        Crear Mi Avatar 3D\n      </button>\n    `;t.innerHTML=e,n.forEach(n=>{const e=t.querySelector(`[data-product-id="${n.id}"]`);e?.addEventListener("click",()=>this.tryOnProduct(n))});const o=document.getElementById("tryonyou-create-avatar");o?.addEventListener("click",()=>this.createAvatar())}_renderError(n){const t=document.getElementById("tryonyou-content");t&&(t.innerHTML=`\n      <div style="padding: 40px; text-align: center; color: #666;">\n        <p>${n}</p>\n        <button onclick="location.reload()" style="margin-top: 16px; padding: 8px 16px; border: 1px solid #ddd; border-radius: 4px; background: #f5f5f5; cursor: pointer;">\n          Reintentar\n        </button>\n      </div>\n    `)}togglePanel(){const n=document.getElementById("tryonyou-panel");if(!n)return;n.classList.contains("open")?this.closePanel():this.openPanel()}openPanel(){const n=document.getElementById("tryonyou-panel");n&&(n.classList.add("open"),this._triggerEvent("panelOpened"))}closePanel(){const n=document.getElementById("tryonyou-panel");n&&(n.classList.remove("open"),this._triggerEvent("panelClosed"))}tryOnProduct(n){console.log("Trying on product:",n),this._triggerEvent("tryOnStarted",{product:n}),alert(`춰Prob치ndote ${n.name}! \n    \nEn la versi칩n completa:\n- Se abrir치 el vestidor 3D\n- Ver치s c칩mo te queda la prenda\n- Recibir치s recomendaciones personalizadas\n- Podr치s comprar directamente`)}createAvatar(){console.log("Creating avatar..."),this._triggerEvent("avatarCreationStarted"),alert("춰Creando tu avatar 3D!\n\nEn la versi칩n completa:\n- Capturaremos tus medidas\n- Generaremos tu avatar 3D personalizado\n- Habilitaremos el probador virtual\n- Activaremos recomendaciones PAU")}setAvatar(n){this.currentUser={...this.currentUser,avatar:n},this._triggerEvent("avatarSet",{avatar:n})}getUser(){return this.currentUser}updateConfig(n){if(this.config={...this.config,...n},n.theme){const t=this.widgetContainer?.querySelector(".tryonyou-widget");t&&(t.className="tryonyou-widget "+("dark"===n.theme?"theme-dark":""))}this._triggerEvent("configUpdated",{config:this.config})}destroy(){this.widgetContainer&&this.widgetContainer.remove(),document.getElementById("tryonyou-styles")?.remove(),document.getElementById("tryonyou-critical-styles")?.remove(),this.isInitialized=!1,this._triggerEvent("destroyed")}_triggerEvent(n,t={}){const e=new CustomEvent(`tryonyou:${n}`,{detail:{...t,timestamp:Date.now()}});document.dispatchEvent(e)}on(n,t){document.addEventListener(`tryonyou:${n}`,t)}off(n,t){document.removeEventListener(`tryonyou:${n}`,t)}};document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector('script[src*="embed.js"]');if(t){const e=t.getAttribute("data-partner-id"),o=t.getAttribute("data-api-key"),r=t.getAttribute("data-theme"),i=t.getAttribute("data-products");if(e){const t={partnerId:e};o&&(t.apiKey=o),r&&(t.theme=r),i&&(t.products=i.split(",")),n.init(t)}}}),"undefined"!=typeof module&&module.exports&&(module.exports=n),"undefined"!=typeof window&&(window.TryOnYou=n);export{n as default};
