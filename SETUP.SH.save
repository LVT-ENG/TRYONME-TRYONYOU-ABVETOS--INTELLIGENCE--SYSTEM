#!/usr/bin/env bash
# Arregla el repo RA√çZ "TRYONME-TRYONYOU-ABVETOS--INTELLIGENCE--SYSTEM"
# - Corrige npm (permisos)
# - Mata watchers viejos (server.js)
# - Convierte el proyecto a Vite 7 (scripts dev/build/preview)
# - Crea index.html + src/* de portada con v√≠deo
# - Prepara vercel.json (rootDirectory = ".")
# - Instala deps y levanta Vite / hace deploy si est√° vercel CLI

set -euo pipefail

echo "‚õèÔ∏è  Corrigiendo permisos de npm/cache‚Ä¶"
sudo chown -R "$(whoami)" "$HOME/.npm" 2>/dev/null || true
sudo chown -R "$(whoami)" "$HOME/.cache" 2>/dev/null || true

echo "üßØ Cerrando watchers antiguos (node --watch src/server.js)‚Ä¶"
pkill -f "node --watch src/server.js" 2>/dev/null || true

echo "üìÅ Verificando que estamos en la RA√çZ (package.json existe)‚Ä¶"
[ -f package.json ] || { echo "‚ùå No hay package.json en esta carpeta. Sit√∫ate en la ra√≠z del repo y relanza."; exit 1; }

echo "üõ†  Ajustando package.json a Vite (dev/build/preview)‚Ä¶"
cp package.json package.json.bak.$(date +%s)
node - <<'NODE'
const fs = require('fs');
const p='package.json';
const pkg=JSON.parse(fs.readFileSync(p,'utf8'));

// scripts de Vite
pkg.scripts = { dev:'vite', build:'vite build', preview:'vite preview' };

// opcional: quita 'main' roto a server.js si exist√≠a
if (pkg.main && /src\/server\.js$/.test(pkg.main)) delete pkg.main;

// asegura type module
pkg.type = pkg.type || 'module';

// nota engines (Vite 7 requiere Node ^20.19.0 || >=22.12.0)  [oai_citation:0‚Ä°package.json](file-service://file-GQ3M47ZodUnNW1TeRcoc9q)
pkg.engines = pkg.engines || {};
pkg.engines.node = pkg.engines.node || '^20.19.0 || >=22.12.0';

fs.writeFileSync(p, JSON.stringify(pkg,null,2));
console.log('‚úÖ package.json actualizado para Vite');
NODE

echo "üß± Estructura m√≠nima Vite + portada con v√≠deo‚Ä¶"
mkdir -p public src

# index.html solo si NO existe
if [ ! -f index.html ]; then
cat > index.html <<'HTML'
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TRYONYOU ‚Äî Luxury Fit ‚Ä¢ Zero Returns</title>
    <meta property="og:title" content="TRYONYOU ‚Äì Luxury Fit" />
    <meta property="og:description" content="Ajuste cient√≠fico (JT) + CAP + ADBET. Compra sin devoluciones." />
    <link rel="preload" as="video" href="/video_portada.mp4" />
    <link rel="stylesheet" href="/src/styles.css" />
  </head>
  <body>
    <header class="nav">
      <div class="container nav__row">
        <a class="brand" href="/">TRYONYOU</a>
        <nav class="nav__links">
          <a href="#cap">CAP</a>
          <a href="#ajuste">JT</a>
          <a href="#adbet">ADBET</a>
          <a class="btn btn--sm" href="#cta">Empezar</a>
        </nav>
      </div>
    </header>

    <section class="hero" id="home" aria-label="Portada TRYONYOU">
      <video class="hero__video" src="/video_portada.mp4" playsinline autoplay muted loop></video>
      <div class="hero__overlay"></div>
      <div class="hero__content container">
        <h1 class="hero__title">Luxury Fit.<br/>Zero Returns.</h1>
        <p class="hero__subtitle">Ajuste cient√≠fico (JT) + CAP + ADBET. Encuentra tu talla perfecta a la primera.</p>
        <div class="hero__cta">
          <a class="btn btn--lg" href="#cta">Probar ahora</a>
          <a class="btn btn--ghost btn--lg" href="#como-funciona">C√≥mo funciona</a>
        </div>
      </div>
    </section>

    <main>
      <section class="grid3 container" id="cap">
        <article class="card"><h3>CAP</h3><p>Control de Ajuste Predictivo.</p></article>
        <article class="card" id="ajuste"><h3>JT (Ajuste)</h3><p>Predicci√≥n de talla precisa.</p></article>
        <article class="card" id="adbet"><h3>ADBET</h3><p>Pago orientado al acierto.</p></article>
      </section>
    </main>

    <footer class="footer">
      <div class="container footer__row">
        <span>¬© <span id="year"></span> TRYONYOU</span>
        <nav class="footer__links"><a href="#">Privacidad</a><a href="#">T√©rminos</a></nav>
      </div>
    </footer>

    <script type="module" src="/src/main.js"></script>
  </body>
</html>
HTML
fi

# JS/CSS si faltan
[ -f src/main.js ] || cat > src/main.js <<'JS'
const y = document.getElementById('year'); if (y) y.textContent = new Date().getFullYear();
document.querySelectorAll('a[href^="#"]').forEach(a=>{
  a.addEventListener('click', e=>{
    const id=a.getAttribute('href'); if(id.length>1){ e.preventDefault(); document.querySelector(id)?.scrollIntoView({behavior:'smooth'}); }
  });
});
console.log('‚ú® TRYONYOU portada lujo con Vite 7');
JS

[ -f src/styles.css ] || cat > src/styles.css <<'CSS'
:root{--bg:#0b0e13;--card:#121722;--muted:#8892a6;--txt:#e9eef9;--gold:#d4af37;--radius:16px;--container:1200px;--shadow:0 10px 24px rgba(0,0,0,.28)}
*{box-sizing:border-box}html,body{margin:0;background:var(--bg);color:var(--txt);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif}
.container{max-width:var(--container);margin-inline:auto;padding-inline:20px}
.nav{position:fixed;inset-inline:0;top:0;z-index:20;background:rgba(11,14,19,.6);backdrop-filter:saturate(140%) blur(10px);border-bottom:1px solid rgba(255,255,255,.06)}
.nav__row{display:flex;align-items:center;justify-content:space-between;min-height:64px}
.brand{font-weight:800;letter-spacing:.5px;color:var(--gold)}
.nav__links{display:flex;gap:18px;align-items:center}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;background:linear-gradient(135deg,var(--gold),#ffe7a3);color:#001014;font-weight:700;padding:.85rem 1.2rem;border-radius:999px;box-shadow:var(--shadow);border:none;cursor:pointer}
.btn--ghost{background:transparent;color:var(--txt);border:1px solid rgba(255,255,255,.18)}.btn--lg{padding:1rem 1.4rem}.btn--sm{padding:.55rem .9rem}
.hero{position:relative;min-height:100svh;display:grid;place-items:center}.hero__video{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
.hero__overlay{position:absolute;inset:0;background:radial-gradient(1100px 600px at 70% 30%, rgba(212,175,55,.25), transparent 60%),linear-gradient(to top, rgba(11,14,19,.92), rgba(11,14,19,.25))}
.hero__content{position:relative;text-align:center;padding-top:64px}
.hero__title{font-size:clamp(2rem,3vw+1rem,4rem);margin:0 0 .5rem;font-weight:900;line-height:1.05}
.hero__subtitle{color:var(--muted);max-width:760px;margin:0 auto 1.5rem;font-size:clamp(.95rem,.6vw+.75rem,1.15rem)}
.grid3{display:grid;gap:20px;margin:64px auto;grid-template-columns:repeat(3,minmax(0,1fr))}@media(max-width:980px){.grid3{grid-template-columns:1fr}}
.card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:var(--radius);padding:24px;box-shadow:var(--shadow)}
.footer{border-top:1px solid rgba(255,255,255,.06);padding:24px 0;margin-top:72px;background:rgba(255,255,255,.02)}
.footer__row{display:flex;justify-content:space-between;align-items:center;gap:16px}.footer__links{display:flex;gap:16px}
CSS

# mover v√≠deo si est√° a nivel ra√≠z
if [ -f "video_portada.mp4" ] && [ ! -f "public/video_portada.mp4" ]; then
  echo "üé¨ Moviendo video_portada.mp4 -> public/"
  mv "video_portada.mp4" "public/video_portada.mp4"
fi

echo "üß© Instalando dependencias + Vite 7‚Ä¶"
npm install
npm i -D vite@7.1.2

echo "üìù vercel.json (rootDirectory = . , static build Vite)‚Ä¶"
cat > vercel.json <<'JSON'
{
  "version": 2,
  "builds": [{ "src": "package.json", "use": "@vercel/static-build" }],
  "framework": "vite",
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "routes": [{ "src": "/(.*)", "dest": "/$1" }]
}
JSON

echo "üîß Build local de verificaci√≥n‚Ä¶"
npm run build

echo "üöÄ Arrancando Vite en dev (CTRL+C para parar)‚Ä¶"
npm run devchmod +x setup.sh
./setup.sh
#!/usr/bin/env bash
set -euo pipefail

echo "üöÄ Iniciando setup de TRYONYOU Ultra con Vite 7..."

# 1. Limpiar proyecto previo
rm -rf node_modules dist package-lock.json

# 2. Inicializar proyecto si falta
if [ ! -f package.json ]; then
  echo "üì¶ Creando package.json..."
  npm init -y
fi

# 3. Configurar scripts para Vite
npx -y vite@latest . -- --template vanilla

# 4. Crear directorios necesarios
mkdir -p src public

# 5. Archivo JS base
cat > src/main.js <<'JS'
console.log("‚ú® TRYONYOU Luxe corriendo con Vite 7 ‚ú®");
document.querySelector("#year").textContent = new Date().getFullYear();
JS

# 6. Archivo CSS base
cat > src/styles.css <<'CSS'
body {
  margin:0;
  font-family: system-ui, sans-serif;
  background: #000;
  color: #fff;
  text-align: center;
}
.overlay {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: white;
}
video {
  width: 100%;
  height: 100vh;
  object-fit: cover;
}
CSS

# 7. HTML base con video portada
cat > index.html <<'HTML'
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TRYONYOU Ultra</title>
    <link rel="stylesheet" href="/src/styles.css" />
  </head>
  <body>
    <video autoplay muted loop playsinline>
      <source src="/video_portada.mp4" type="video/mp4" />
      Tu navegador no soporta video.
    </video>
    <div class="overlay">
      <h1>TRYONYOU</h1>
      <p>Luxury Digital Wardrobe Experience</p>
      <span id="year"></span>
    </div>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
HTML

# 8. Copiar video a public (ajusta la ruta si lo tienes en otra carpeta)
if [ -f ./video_portada.mp4 ]; then
  mv video_portada.mp4 public/video_portada.mp4
fi

# 9. Instalar dependencias
npm install

# 10. Configuraci√≥n Vercel
cat > vercel.json <<'JSON'
{
  "version": 2,
  "builds": [{ "src": "package.json", "use": "@vercel/static-build" }],
  "framework": "vite",
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "routes": [{ "src": "/(.*)", "dest": "/dist/$1" }]
}
JSON

echo "‚úÖ Setup completado."
echo "üëâ Ejecuta ahora: npm run dev"
chmod 777 setup.sh
./setup.sh
npm run dev

