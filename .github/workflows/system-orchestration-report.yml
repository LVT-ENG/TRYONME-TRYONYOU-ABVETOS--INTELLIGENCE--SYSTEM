name: EPIC Monitor â€“ System Orchestration
on:
  schedule:
    - cron: "0 */12 * * *"
  workflow_dispatch:

permissions:
  contents: write

jobs:
  report:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: ðŸ§  Generate Status JSON
        run: |
          echo '{
            "timestamp": "'$(date -u +"%Y-%m-%dT%H:%M:%SZ")'",
            "Legal": "âœ… Up to date (EPCT_MASTER_2025.pdf)",
            "Infra": "âœ… Stable (Vercel + GitHub OK)",
            "CI_CD": "âœ… Build OK ('$(git rev-parse --short HEAD)')",
            "Visual": "âœ… Hero + Pau Live"
          }' > src/dashboard/apiStatus.json

      - name: ðŸŸ¢ Commit & Push Status
        run: |
          git config --global user.name "Agent 70"
          git config --global user.email "deploy@tryonyou.app"
          git add src/dashboard/apiStatus.json
          git diff --staged --quiet || git commit -m "ðŸ§© Update EPIC Monitor status"
          git push
          
      - name: ðŸ“© Telegram Notify
        run: |
          MSG="ðŸª¶ EPIC Monitor Updated\nLegalâœ… Infraâœ… CI/CDâœ… Visualâœ…\n$(date)"
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
          -d chat_id=${{ secrets.TELEGRAM_CHAT_ID }} -d text="$MSG"
